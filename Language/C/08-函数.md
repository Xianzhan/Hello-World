<!-- TOC -->

- [调用者与被调用者](#调用者与被调用者)
- [声明与定义](#声明与定义)
- [主函数 main](#主函数-main)

<!-- /TOC -->

为了使一个 C 语言程序写出更良好的结构化、模块化的代码，我们需要借助函数（function）。

# 调用者与被调用者

所谓调用者是指调用某一函数的函数，被调用者则是当前被调用的函数。比如，我们在 main 函数中调用 printf 函数，那么对于 printf 函数而言，调用者就是 main 函数，printf 则是被调用者，而调用该 printf 函数时所处的位置则称为函数调用点（invoke point）。

# 声明与定义

C 语言中，一个函数由返回类型、函数名以及形式参数（简称形参）列表构成。在 C 语言标准中，又把函数名称作为函数标志（function designator）。函数声明以如下形式表示：

```c
返回类型 函数名(形参列表)
```

形参列表中，每个形式参数（parameter）用逗号分隔。比如：int foo (int a, f loat b);这就是一个函数声明。该声明给出了一个名为 foo 的函数，其返回类型为 int，其形参列表为 (int a, float b)；该列表声明了函数 foo 带有两个形参，第一个形参为 int 类型，第二个形参为 float 类型。如果一个函数不返回任何值，那么其返回类型用 void 表示。如果一个函数不含有任何形式参数，那么参数列表可用 () 或 (void) 来表示。因为这样函数声明与函数调用不容易被搞混。在老式的 C 语言编译器中，允许缺省函数返回类型，如果缺省，则默认函数返回类型为 int。但对于现代 C 语言编译器而言，如果不写函数返回类型则会报出警告，尽管也会将该函数的返回类型默认作为 int 类型处理。

一个函数声明给出了该函数的**原型（prototype）**，一个函数原型能确定该函数的一个比较完整的类型。如果函数声明不作为函数定义的一部分，那么形参列表中的形参可含有不完整类型的形参，另外可以用 [ * ] 来表示变长数组类型；否则每个形参都必须是完整类型的。在一个函数原型中，函数形参列表中每个形参的标识符可省。比如上述的 foo 函数可声明为：

```c
int foo(int, float);
```

函数定义的一般形式为：

```c
存储类说明符可省 返回类型 函数名(形参列表) { 复合语句; }
```

在函数定义中，要么形参列表中的每个形参类型必须是完整类型，要么形参列表为空列表。返回类型也必须是完整类型或 `void` 类型。另外，存储类说明符只能用 `extern` 或 `static`，或者可缺省。如果缺省存储类说明符，则默认为 `extern`。`extern` 存储类说明符表示一个函数具有外部连接；`static` 存储类说明符表示一个函数具有内部连接。

# 主函数 main

在 C 语言中，将应用启动时调用的函数命名为 main 函数。C 语言实现不需要对此函数做原型声明。它应该被定义为返回类型为 int，并且不带任何形参的函数，如：`int main(void){ /* ... */}`； 或者带有两个形参的函数，如：`int main(int argc, char *argv[]) { /* ... */ }`。这两个形参所对应的实参是在执行该程序时传入的。argc 一般存放执行当前程序时输入的命令字符串个数；argv 则存放了指向各个输入字符串的指针。假设我们现在对 C 源文件编译构建后，生成了一个名为 test 的可执行文件。那么我们在控制台中输入 `test arg1 arg2`，再按回车，那么此时，main 函数的第一个参数 argc 的值为 3，因为 test 其实就属于要传入到 argv 数组的第 1 个参数，然后后面跟着 2 个命令行参数 arg1 和 arg2；所以 argv 对应的实参内容为：`{ "test", "arg1", "arg2" }`，即由应用程序名与其命令行参数字符串所构成的数组。如果将 main 函数声明为带有两个形参的形式，那么它们应该遵循以下约束：

1. argc 的值应该是一个非负数。
2. argv[argc] 应该是一个空指针。
3. 如果 argc 的值大于零，那么数组成员 argv[0] 到 argv[argc-1] 应该包含指向字符串的指针，这些字符串在程序启动前由主机环境给出。如果 argc 的值大于 1，那么 argv[1] 到 argv[argc-1] 所指向的字符串才表示程序形参，即当前应用名后面的命令行参数。
4. 形参 argc 和 argv 以及 argv 数组所指向的字符串可以在程序中修改，并且在程序启动和终止之间保留其最后被修改的值。

main 函数的返回值相当于调用库函数 exit 所传入的实参值。如果 main 函数中缺省 return 语句，那么默认为 return 0。

程序默认的入口函数就是 main 函数，因此 main 函数必须要有外部连接，它不能是 `static` 的。此外，main 函数也不能带有 `inline`、`_Noreturn` 等函数说明符。
