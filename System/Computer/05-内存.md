<!-- TOC -->

- [内存](#内存)
    - [物理机制](#物理机制)
    - [逻辑模型](#逻辑模型)

<!-- /TOC -->

# 内存

> 我们通常所说的内存或主存（Main Memory）, 其存储介质属于 RAM（RandomAccess Memory），即随机访问存储器。它的特点是访问速度快，**可对单个字节进行读写**，这与 ROM 需要擦除整个扇区再对整个扇区写入的方式有所不同，因此更高效、灵活。但是 RAM 的数据无法持久化，掉电之后就会消失。

## 物理机制

内存实际上是一种名为内存 IC 的电子元件, 虽然内存 IC 包括 DRAM、SRAM、ROM 等多种形式, 但从外部来看, 其基本机制都是一样的. 内存 IC 中有电源、地址信号、数据信号、控制信号等用于输入输出的大量引脚(IC 的引脚), 通过为其制定地址(address)来进行数据的读写.

下面是内存 IC(在这里假定它为 RAM)的引脚, VCC 和 GND 是电源, A0~A9 是地址信号的引脚, D0~D7 是数据信号的引脚, RD 和 WR 是控制信号的引脚. 将电源连接到 VCC 和 GND 后, 就可以给其它引脚传递比如 0 或者 1 这样的信号. 大多数情况下, +5V 的直流电压表示 1, 0V 表示 0.

```sh
  VCC A0  A1  A2  A3  A4  A5  A6  A7  A8  A9
   |   |   |   |   |   |   |   |   |   |   |
 +-+---+---+---+---+---+---+---+---+---+---+-+
 |                Memory IC                  |
 +-+---+---+---+---+---+---+---+---+---+---+-+
   |   |   |   |   |   |   |   |   |   |   |
  RD  WR  D0  D1  D2  D3  D4  D5  D6  D7  GND
VCC/GND: 电源
  A0~A9: 地址信号
  D0~D7: 数据信号
  RD/WR: 控制信号
```

那么，这个内存IC中能存储多少数据呢？数据信号引脚有 D0~D7 共八个，表示一次可以输入输出 8 位（=1 字节）的数据。此外，地址信号引脚有 A0~A9 共十个，表示可以指定 0000000000~1111111111 共 1024 个地址。而地址用来表示数据的存储场所，因此我们可以得出这个内存 IC 中可以存储 1024 个 1 字节的数据。因为 1024=1K，所以该内存 IC 的容量就是 1KB。

现在大家使用的计算机至少有 512M 的内存。这就相当于 512000 个（512MB÷1KB=512K）1KB 的内存 IC。当然，一台计算机中不太可能放入如此多的内存 IC。通常情况下，计算机使用的内存 IC 中会有更多的地址信号引脚，这样就能在一个内存 IC 中存储数十兆字节的数据。因此，只用数个内存 IC，就可以达到 512MB 的容量。

下面让我们继续来看刚才所说的 1KB 的内存 IC。首先，我们假设要往该内存 IC 中写入 1 字节的数据。为了实现该目的，可以给 VCC 接入 +5V，给 GND 接入 0V 的电源，并使用 A0~A9 的地址信号来指定数据的存储场所，然后再把数据的值输入给 D0~D7 的数据信号，并把 WR（write=写入的简写）信号设定成 1。执行完这些操作，就可以在内存 IC 内部写入数据了。

```sh
# (a) 往 0101010101 地址写入 11110000 数据时
  VCC A0  A1  A2  A3  A4  A5  A6  A7  A8  A9
  +5V  0   1   0   1   0   1   0   1   0   1  ← (1)指定地址
   |   |   |   |   |   |   |   |   |   |   |
 +-+---+---+---+---+---+---+---+---+---+---+-+
 |                Memory IC                  |
 +-+---+---+---+---+---+---+---+---+---+---+-+
   |   |   |   |   |   |   |   |   |   |   |
   0   1   1   1   1   1   0   0   0   0   0V ← (2)输入数据
  RD  WR  D0  D1  D2  D3  D4  D5  D6  D7  GND
      (3)将 WR(写入)信号设为 "1"

# (b) 读出 01010101 地址的数据时
  VCC A0  A1  A2  A3  A4  A5  A6  A7  A8  A9
  +5V  0   1   0   1   0   1   0   1   0   1  ← (1)指定地址
   |   |   |   |   |   |   |   |   |   |   |
 +-+---+---+---+---+---+---+---+---+---+---+-+
 |                Memory IC                  |
 +-+---+---+---+---+---+---+---+---+---+---+-+
   |   |   |   |   |   |   |   |   |   |   |
   1   0   1   1   1   1   0   0   0   0   0V ← (3)读出数据
  RD  WR  D0  D1  D2  D3  D4  D5  D6  D7  GND
      (2)将 RD(读出)信号设为 "1"
```

读出数据时，只需通过 A0~A9 的地址信号指定数据的存储场所，然后再将 RD（read=读出的简写）信号设成 1 即可。执行完这些操作，指定地址中存储的数据就会被输出到 D0~D7 的数据信号引脚中。另外，像 WR 和 RD 这样可以让 IC 运行的信号称为控制信号。其中，当 WR 和 RD 同时为 0 时，写入和读出的操作都无法进行。

由此可见，内存 IC 的物理机制实质上是很简单的。总体来讲，内存 IC 内部有大量可以存储 8 位数据的地方，通过地址指定这些场所，之后即可进行数据的读写。

## 逻辑模型

虽然内存的实体是内存 IC，不过从程序员的角度来看，也可以把它假想成每层都存储着数据的楼房，并不需要过多地关注内存 IC 的电源和控制信号等。内存为 1KB 时，表示的是有 1024 层的楼房（这里地址的值是从上往下逐渐变大，不过也有与此相反的情况）。

```sh
地址          内容
0000000000 | 1 Byte |
0000000001 | 1 Byte |
0000000010 | 1 Byte |
     .     |   .    |
     .     |   .    |
     .     |   .    |
1111111110 | 1 Byte |
1111111111 | 1 Byte |
```

不过，程序员眼里的内存模型中，还包含着物理内存中不存在的概念，那就是数据类型。编程语言中的数据类型表示存储的是何种类型的数据。从内存来看，就是占用的内存大小（占有的楼层数）的意思。即使是物理上以 1 个字节为单位来逐一读写数据的内存，在程序中，通过指定其类型（变量的数据类型等），也能实现以特定字节数为单位来进行读写。

下面我们来看一个具体的示例。这是一个往 a、b、c 这 3 个变量中写入数据 123 的 C 语言程序。这 3 个变量表示的是内存的特定区域。通过使用变量，即便不指定物理地址，也可以在程序中对内存进行读写。这是因为，在程序运行时，Windows 等操作系统会自动决定变量的物理地址。

```c
// 定义
char  a;
short b;
long  c;

// 赋值
a = 123;
b = 123;
c = 123;
```

这 3 个变量的数据类型分别是，表示 1 字节长度的 char，表示 2 字节长度的 short，以及表示 4 字节长度的 long。因此，虽然同样是数据 123，存储时其所占用的内存大小是不一样的。这里，我们假定采用的是将数据低位存储在内存低位地址的低字节序（little endian）。

```sh
地址             内容
     .        |   .    |
xxxxxxxxxx +0 | 123    | # a char  1 字节
xxxxxxxxxx +1 | 123    | # b short 2 字节
xxxxxxxxxx +2 | 0      |
xxxxxxxxxx +3 | 123    | # c long  3 字节
xxxxxxxxxx +4 | 0      |
xxxxxxxxxx +5 | 0      |
xxxxxxxxxx +6 | 0      |
     .        |   .    |
```

仔细思考一下就会发现，根据程序中所指定的变量的数据类型的不同，读写的物理内存大小也会随之发生变化，这其实是非常方便的。大家不妨想一想，假如程序中只能逐个字节地对内存进行读写，那该多么不便啊。在处理超过 1 个字节的数据时，还必须要编写分割处理程序。此外，在不同的编程语言中，变量可以指定的数据类型的最大长度也不相同。C 语言中，8 字节（=64位）的 double 类型是最大的。
